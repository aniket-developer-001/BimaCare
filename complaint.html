<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Complaint Page - BimaCare</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<link rel="stylesheet" href="main.css">
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
  body{background:#f5f7ff;color:#0A1A3C;padding-bottom:24px;}

  a{color:inherit;text-decoration:none;}

  /* ===== Header ===== */
  .topHeader{
    width:100%;
    background:#0A1A3C;
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding:14px 16px;
    position:sticky;
    top:0;
    z-index:100;
    border-bottom:1px solid rgba(255,255,255,0.12);
  }
  .topHeader h2{
    font-size:17px;
    font-weight:1000;
    letter-spacing:0.2px;
  }
  .topHeader .iconBtn{
    width:42px;height:42px;
    border-radius:16px;
    display:flex;
    align-items:center;
    justify-content:center;
    background:rgba(255,255,255,0.12);
    border:1px solid rgba(255,255,255,0.14);
  }

  /* ===== Layout ===== */
  .wrap{
    width:100%;
    max-width:980px;
    margin:auto;
    padding:14px;
  }

  .card{
    background:#fff;
    border-radius:22px;
    padding:16px;
    border:1px solid rgba(0,0,0,0.06);
    box-shadow:0 16px 45px rgba(0,0,0,0.06);
    margin-bottom:14px;
  }

  .titleRow{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:12px;
  }

  .title{
    font-size:16px;
    font-weight:1000;
    margin-bottom:6px;
  }
  .sub{
    font-size:13px;
    font-weight:850;
    color:#64748b;
    line-height:1.45;
  }

  .chip{
    padding:8px 12px;
    border-radius:999px;
    font-size:12px;
    font-weight:1000;
    border:1px solid rgba(37,99,235,0.18);
    background:rgba(37,99,235,0.08);
    color:#1d4ed8;
    display:flex;
    align-items:center;
    gap:8px;
    white-space:nowrap;
  }

  /* ===== Form ===== */
  .formGrid{
    margin-top:14px;
    display:grid;
    grid-template-columns:1fr;
    gap:12px;
  }
  @media(min-width:860px){
    .formGrid{grid-template-columns:1fr 1fr;}
  }

  .field{
    display:flex;
    flex-direction:column;
    gap:7px;
  }
  .field label{
    font-size:12px;
    font-weight:950;
    color:#475569;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .field label i{color:#2563eb;}

  .inputWrap{
    position:relative;
  }
  .inputWrap i{
    position:absolute;
    left:14px;
    top:50%;
    transform:translateY(-50%);
    color:#2563eb;
    font-size:14px;
    opacity:0.95;
  }

  input, select, textarea{
    width:100%;
    border:1px solid rgba(15,23,42,0.12);
    background:#fbfbff;
    border-radius:18px;
    padding:13px 14px 13px 42px;
    outline:none;
    font-size:13px;
    font-weight:900;
    color:#0A1A3C;
    transition:0.2s ease;
  }
  textarea{
    padding:13px 14px;
    min-height:120px;
    resize:none;
  }
  input:focus, select:focus, textarea:focus{
    border-color:rgba(37,99,235,0.55);
    box-shadow:0 0 0 4px rgba(37,99,235,0.12);
  }

  .full{grid-column:1/-1;}

  .btnRow{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-top:12px;
  }

  .btn{
    border:none;
    cursor:pointer;
    padding:13px 16px;
    border-radius:18px;
    font-weight:1000;
    font-size:13px;
    transition:0.2s ease;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:10px;
  }
  .btn:active{transform:scale(0.99);}

  .btnPrimary{
    background:linear-gradient(135deg,#2563eb,#7c3aed);
    color:#fff;
    flex:1;
    min-width:190px;
    box-shadow:0 14px 35px rgba(37,99,235,0.22);
  }
  .btnGhost{
    background:#f1f5ff;
    color:#0A1A3C;
    border:1px solid rgba(37,99,235,0.18);
  }

  .error{
    font-size:12px;
    font-weight:900;
    color:#dc2626;
    margin-top:4px;
    display:none;
  }

  /* ===== Status Toast ===== */
  .toast{
    margin-top:12px;
    padding:12px 14px;
    border-radius:18px;
    font-size:13px;
    font-weight:950;
    display:none;
    align-items:center;
    gap:10px;
  }
  .toast.ok{
    display:flex;
    background:rgba(34,197,94,0.12);
    border:1px solid rgba(34,197,94,0.22);
    color:#166534;
  }
  .toast.bad{
    display:flex;
    background:rgba(220,38,38,0.10);
    border:1px solid rgba(220,38,38,0.18);
    color:#b91c1c;
  }

  /* ===== Complaints List ===== */
  .list{
    margin-top:14px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .complaintItem{
    padding:14px;
    border-radius:22px;
    border:1px solid rgba(15,23,42,0.10);
    background:linear-gradient(180deg,#ffffff,#fbfbff);
    position:relative;
    overflow:hidden;
  }

  .complaintItem::before{
    content:"";
    position:absolute;
    left:0;top:0;
    width:6px;height:100%;
    background:linear-gradient(180deg,#2563eb,#7c3aed);
    opacity:0.95;
  }

  .topLine{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    padding-left:8px;
  }

  .name{
    font-weight:1000;
    font-size:14px;
    color:#0A1A3C;
  }

  .meta{
    margin-top:4px;
    font-size:12px;
    font-weight:900;
    color:#64748b;
    line-height:1.55;
  }
  .meta b{color:#0A1A3C;}

  .badge{
    padding:8px 12px;
    border-radius:999px;
    font-size:12px;
    font-weight:1000;
    border:1px solid rgba(0,0,0,0.08);
    white-space:nowrap;
    display:flex;
    align-items:center;
    gap:8px;
  }
  .pending{
    background:rgba(245,158,11,0.10);
    color:#b45309;
    border-color:rgba(245,158,11,0.25);
  }
  .resolved{
    background:rgba(34,197,94,0.12);
    color:#166534;
    border-color:rgba(34,197,94,0.25);
  }

  .msg{
    margin-top:10px;
    font-size:13px;
    font-weight:900;
    color:#334155;
    line-height:1.6;
    padding-left:8px;
  }

  .msgTitle{
    display:flex;
    align-items:center;
    gap:8px;
    font-weight:1000;
    color:#0A1A3C;
    margin-bottom:6px;
  }
  .msgTitle i{color:#2563eb;}

  .actionRow{
    margin-top:12px;
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    padding-left:8px;
  }

  .miniBtn{
    padding:10px 12px;
    border-radius:16px;
    border:none;
    cursor:pointer;
    font-weight:1000;
    font-size:12px;
    display:flex;
    align-items:center;
    gap:8px;
    transition:0.2s ease;
  }
  .miniBtn:hover{transform:translateY(-1px);}

  .miniResolve{
    background:rgba(34,197,94,0.12);
    color:#166534;
    border:1px solid rgba(34,197,94,0.25);
  }
  .miniDelete{
    background:rgba(220,38,38,0.10);
    color:#b91c1c;
    border:1px solid rgba(220,38,38,0.20);
  }
  .miniCopy{
    background:rgba(37,99,235,0.10);
    color:#1d4ed8;
    border:1px solid rgba(37,99,235,0.18);
  }

  .empty{
    text-align:center;
    padding:20px 10px;
    color:#64748b;
    font-weight:950;
    font-size:13px;
  }/* ===== Professional Popup ===== */
.proOverlay{
  position:fixed;
  inset:0;
  background:rgba(10,26,60,0.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
  padding:20px;
}

.proModal{
  width:100%;
  max-width:360px;
  background:#fff;
  border-radius:24px;
  padding:26px 20px;
  text-align:center;
  box-shadow:0 30px 60px rgba(0,0,0,0.25);
  animation:popIn .25s ease;
}

@keyframes popIn{
  from{opacity:0;transform:translateY(25px) scale(.95);}
  to{opacity:1;transform:translateY(0) scale(1);}
}

.proIcon{
  font-size:28px;
  margin-bottom:12px;
}

.proTitle{
  font-size:16px;
  font-weight:1000;
  margin-bottom:6px;
  color:#0A1A3C;
}

.proMessage{
  font-size:13px;
  font-weight:900;
  color:#64748b;
  margin-bottom:18px;
}

.proActions{
  display:flex;
  gap:10px;
}

.proBtn{
  flex:1;
  border:none;
  padding:12px;
  border-radius:16px;
  font-weight:1000;
  font-size:13px;
  cursor:pointer;
}

.proOk{
  background:linear-gradient(135deg,#2563eb,#7c3aed);
  color:#fff;
}

.proCancel{
  background:#f1f5ff;
  border:1px solid rgba(37,99,235,0.25);
  color:#0A1A3C;
}

.proDanger{
  background:rgba(220,38,38,0.12);
  border:1px solid rgba(220,38,38,0.25);
  color:#b91c1c;
}
</style>
</head>

<body>

<header class="topHeader">
  <div class="iconBtn">
    <a href="https://aniket-developer-001.github.io/BimaCare/home.html"><i class="fa-solid fa-arrow-left"></i></a>
  </div>
  <h2>Complaint Support</h2>
  <div class="iconBtn"><i class="fa-solid fa-headset"></i></div>
</header>

<main class="wrap">

  <!-- Complaint Form -->
  <section class="card">
    <div class="titleRow">
      <div>
        <div class="title">Submit Your Complaint</div>
        <div class="sub">
          Your complaint will be saved on your device + sent to our support email.
        </div>
      </div>

      
    </div>

    <!-- IMPORTANT: Web3Forms form -->
    <form id="complaintForm" class="formGrid" action="https://api.web3forms.com/submit" method="POST">

      <!-- REQUIRED -->
      <input type="hidden" name="access_key" value="96018cbc-b973-4274-9edc-dd2120e8f623">

      <!-- Hidden send -->
      <input type="hidden" name="complaint_code" id="complaint_code" value="">
      <input type="hidden" name="submitted_date" id="submitted_date" value="">
      <input type="hidden" name="source" value="BimaCare - Complaint Page">

      <div class="field">
        <label><i class="fa-solid fa-user"></i> Full Name</label>
        <div class="inputWrap">
          <i class="fa-solid fa-user"></i>
          <input type="text" id="name" name="name" placeholder="Enter your full name">
        </div>
        <div class="error" id="nameErr">Please enter a valid name (min 3 letters).</div>
      </div>

      <div class="field">
        <label><i class="fa-solid fa-phone"></i> Phone Number</label>
        <div class="inputWrap">
          <i class="fa-solid fa-phone"></i>
          <input type="tel" id="phone" name="phone" placeholder="Enter 10 digit number">
        </div>
        <div class="error" id="phoneErr">Please enter a valid 10-digit phone number.</div>
      </div>

      <div class="field full">
        <label><i class="fa-solid fa-list"></i> Complaint Type</label>
        <div class="inputWrap">
          <i class="fa-solid fa-list"></i>
          <select id="type" name="complaint_type">
            <option value="">Select complaint type</option>
            <option value="Insurance Compare">Insurance Compare</option>
            <option value="EMI Calculator">EMI Calculator</option>
            <option value="Premium Calculator">Premium Calculator</option>
            <option value="Login / Account">Login / Account</option>
            <option value="App Bug / Issue">App Bug / Issue</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="error" id="typeErr">Please select complaint type.</div>
      </div>

      <div class="field full">
        <label><i class="fa-solid fa-message"></i> Complaint Message</label>
        <textarea id="message" name="message" placeholder="Write your complaint details..."></textarea>
        <div class="error" id="msgErr">Please write complaint (min 10 characters).</div>
      </div>

      <div class="btnRow full">
        <button type="submit" class="btn btnPrimary" id="submitBtn">
          <i class="fa-solid fa-paper-plane"></i> Submit Complaint
        </button>

        
      </div>

      <div class="toast" id="toastBox"></div>

    </form>
  </section>

  <!-- Complaint List -->
  <section class="card">
    <div class="title">Your Complaints</div>
    <div class="sub">
      Below is your complaint history. You can mark resolved, copy ID or delete.
    </div>

    <div class="list" id="complaintList"></div>
  </section>

</main>
<!-- ===== Global Popup ===== -->
<div id="proOverlay" class="proOverlay">
  <div class="proModal">
    <div class="proIcon" id="proIcon"></div>
    <div class="proTitle" id="proTitle"></div>
    <div class="proMessage" id="proMessage"></div>
    <div class="proActions" id="proActions"></div>
  </div>
</div>
<script>
/* ===========================
   SIMPLE DARK MODE LOADER
   =========================== */

const THEME_KEY = "dark_mode"; // localStorage key

function loadThemeFromStorage() {
  const mode = localStorage.getItem(THEME_KEY);
  
  if (mode === "yes") {
    document.body.classList.add("dark");
  } else {
    document.body.classList.remove("dark");
  }
}

/* Run when page loads */
document.addEventListener("DOMContentLoaded", loadThemeFromStorage);
const proOverlay = document.getElementById("proOverlay");
const proIcon = document.getElementById("proIcon");
const proTitle = document.getElementById("proTitle");
const proMessage = document.getElementById("proMessage");
const proActions = document.getElementById("proActions");

function closePopup() {
  proOverlay.style.display = "none";
}

function showPopup({ icon, title, message, buttons }) {
  proIcon.innerHTML = icon;
  proTitle.innerText = title;
  proMessage.innerText = message;
  proActions.innerHTML = buttons;
  proOverlay.style.display = "flex";
}
  const form = document.getElementById("complaintForm");

  const nameEl = document.getElementById("name");
  const phoneEl = document.getElementById("phone");
  const typeEl = document.getElementById("type");
  const messageEl = document.getElementById("message");

  const nameErr = document.getElementById("nameErr");
  const phoneErr = document.getElementById("phoneErr");
  const typeErr = document.getElementById("typeErr");
  const msgErr = document.getElementById("msgErr");

  const listBox = document.getElementById("complaintList");
 

  const toastBox = document.getElementById("toastBox");
  const submitBtn = document.getElementById("submitBtn");

  
  const complaintCodeHidden = document.getElementById("complaint_code");
  const submittedDateHidden = document.getElementById("submitted_date");

  const STORAGE_KEY = "bimaBondhu_complaints";

  /* =========================
      HELPERS
  ========================= */

  function getComplaints(){
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
  }

  function saveComplaints(data){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function escapeHtml(text){
    return (text || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  function nowDate(){
    return new Date().toLocaleString("en-IN", {
      day:"2-digit", month:"short", year:"numeric",
      hour:"2-digit", minute:"2-digit"
    });
  }

  function generateComplaintCode(){
    // C-267818 (6 digit)
    const n = Math.floor(100000 + Math.random() * 900000);
    return "C-" + n;
  }

  function showToast(type, msg){
    toastBox.className = "toast " + (type === "ok" ? "ok" : "bad");
    toastBox.innerHTML = (type === "ok"
      ? `<i class="fa-solid fa-circle-check"></i> ${escapeHtml(msg)}`
      : `<i class="fa-solid fa-triangle-exclamation"></i> ${escapeHtml(msg)}`
    );

    setTimeout(()=>{
      toastBox.style.display = "none";
      toastBox.className = "toast";
      toastBox.innerHTML = "";
    }, 3500);
  }

  function showError(el, show){
    el.style.display = show ? "block" : "none";
  }

  function resetErrors(){
    showError(nameErr,false);
    showError(phoneErr,false);
    showError(typeErr,false);
    showError(msgErr,false);
  }

  /* =========================
      INPUT RULES
  ========================= */

  phoneEl.addEventListener("input", ()=>{
    phoneEl.value = phoneEl.value.replace(/[^0-9]/g,"").slice(0,10);
  });

  /* =========================
      VALIDATION
  ========================= */

  function validate(){
    resetErrors();

    const name = nameEl.value.trim();
    const phone = phoneEl.value.trim();
    const type = typeEl.value.trim();
    const message = messageEl.value.trim();

    let ok = true;

    if(name.length < 3){
      showError(nameErr,true);
      ok = false;
    }

    if(!/^[0-9]{10}$/.test(phone)){
      showError(phoneErr,true);
      ok = false;
    }

    if(type === ""){
      showError(typeErr,true);
      ok = false;
    }

    if(message.length < 10){
      showError(msgErr,true);
      ok = false;
    }

    return ok;
  }

  /* =========================
      RENDER LIST
  ========================= */

  function render(){
    const data = getComplaints();

    if(data.length === 0){
      listBox.innerHTML = `<div class="empty">
        <i class="fa-solid fa-inbox" style="font-size:20px;margin-bottom:8px;"></i><br>
        No complaints submitted yet.
      </div>`;
      return;
    }

    const sorted = [...data].sort((a,b)=> b.timeStamp - a.timeStamp);

    listBox.innerHTML = sorted.map(item => {
      const badgeClass = item.status === "Resolved" ? "resolved" : "pending";

      return `
        <div class="complaintItem">
          <div class="topLine">
            <div>
              <div class="name">${escapeHtml(item.name)}</div>
              <div class="meta">
                <b>${escapeHtml(item.type)}</b> <br />Code: <b>${escapeHtml(item.code)}</b><br>
                <i class="fa-solid fa-calendar-days"></i> ${escapeHtml(item.date)}
              </div>
            </div>

            
          </div>

          <div class="msg">
            <div class="msgTitle">
              <i class="fa-solid fa-message"></i> Message
            </div>
            ${escapeHtml(item.message)}
          </div>

          <div class="actionRow">
            <button class="miniBtn miniCopy" onclick="copyComplaint('${item.code}')">
              <i class="fa-solid fa-copy"></i> Copy Code
            </button>

            

            <button class="miniBtn miniDelete" onclick="deleteComplaint('${item.code}')">
              <i class="fa-solid fa-trash"></i> Delete
            </button>
          </div>
        </div>
      `;
    }).join("");
  }

  /* =========================
      ACTIONS
  ========================= */

  function deleteComplaint(code) {
  
  showPopup({
    icon: `<i class="fa-solid fa-triangle-exclamation" style="color:#dc2626;"></i>`,
    title: "Delete Complaint?",
    message: "This action cannot be undone.",
    buttons: `
      <button class="proBtn proCancel" onclick="closePopup()">Cancel</button>
      <button class="proBtn proDanger" onclick="confirmDelete('${code}')">Delete Anyway</button>
    `
  });
  
}

function confirmDelete(code) {
  const data = getComplaints().filter(x => x.code !== code);
  saveComplaints(data);
  render();
  
  showPopup({
    icon: `<i class="fa-solid fa-circle-check" style="color:#22c55e;"></i>`,
    title: "Deleted Successfully",
    message: "Complaint has been removed.",
    buttons: `<button class="proBtn proOk" onclick="closePopup()">Close</button>`
  });
}

  function copyComplaint(code) {
  navigator.clipboard.writeText(code);
  
  showPopup({
    icon: `<i class="fa-solid fa-copy" style="color:#2563eb;"></i>`,
    title: "Copied",
    message: "Complaint code copied successfully.",
    buttons: `<button class="proBtn proOk" onclick="closePopup()">Close</button>`
  });
}

  
  /* =========================
      WEB3FORMS SUBMIT
  ========================= */

  function setNewCodeOnUI(){
    const code = generateComplaintCode();
    complaintCodeHidden.value = code;
    submittedDateHidden.value = nowDate();
    return code;
  }

  // Generate first code
  setNewCodeOnUI();

  form.addEventListener("submit", async (e)=>{
    e.preventDefault();

    if(!validate()){
      showToast("bad", "Please fill all fields correctly.");
      return;
    }

    // Disable button
    submitBtn.disabled = true;
    submitBtn.style.opacity = "0.8";
    submitBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Sending...`;

    const code = complaintCodeHidden.value;
    const date = submittedDateHidden.value;

    // Save LocalStorage first (always)
    const complaint = {
      code: code,
      name: nameEl.value.trim(),
      phone: phoneEl.value.trim(),
      type: typeEl.value.trim(),
      message: messageEl.value.trim(),
      date: date,
      status: "Pending",
      timeStamp: Date.now()
    };

    const data = getComplaints();
    data.push(complaint);
    saveComplaints(data);

    // Send to Web3Forms
    try{
      const formData = new FormData(form);

      const res = await fetch(form.action, {
        method: "POST",
        body: formData
      });

      const json = await res.json();

      if(json.success){
        showToast("ok", "Complaint submitted successfully!");
      }else{
        showToast("bad", "Saved locally, but API failed. Try again later.");
      }
    }catch(err){
      showToast("bad", "Saved locally, but network error. Try again later.");
    }

    // Reset UI
    form.reset();
    resetErrors();
    render();

    // new code again
    setNewCodeOnUI();

    submitBtn.disabled = false;
    submitBtn.style.opacity = "1";
    submitBtn.innerHTML = `<i class="fa-solid fa-paper-plane"></i> Submit Complaint`;
  });

  /* =========================
      INIT
  ========================= */

  render();

  // Expose for inline onclick
  window.deleteComplaint = deleteComplaint;
  
  window.copyComplaint = copyComplaint;

</script>
</body>
</html>